---
layout: post
title: Effectively Testing Services on Rails
tags:
- talk
---

### 视频

<video class="video" poster="/assets/Effectively-Testing-Services-on-Rails/poster.jpg" preload controls>
  <source src="/assets/Effectively-Testing-Services-on-Rails/video.webm" type="video/webm">
  <source src="/assets/Effectively-Testing-Services-on-Rails/video.mp4" type="video/mp4">
</video>

原视频地址：<https://www.youtube.com/watch?v=sMWthvdWS-w>

### 幻灯片

<div class="slideshow">
  <img src="/assets/Effectively-Testing-Services-on-Rails/slide_1.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_2.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_3.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_4.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_5.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_6.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_7.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_8.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_9.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_10.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_11.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_12.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_13.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_14.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_15.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_16.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_17.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_18.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_19.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_20.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_21.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_22.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_23.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_24.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_25.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_26.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_27.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_28.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_29.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_30.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_31.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_32.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_33.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_34.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_35.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_36.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_37.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_38.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_39.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_40.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_41.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_42.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_43.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_44.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_45.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_46.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_47.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_48.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_49.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_50.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_51.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_52.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_53.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_54.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_55.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_56.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_57.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_58.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_59.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_60.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_61.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_62.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_63.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_64.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_65.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_66.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_67.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_68.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_69.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_70.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_71.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_72.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_73.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_74.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_75.jpg">
  <img src="/img/loading.gif" class="lazy" data-src="/assets/Effectively-Testing-Services-on-Rails/slide_76.jpg">
</div>

原幻灯片地址：<http://www.slideshare.net/neal_kemp/effectively-testing-services-on-rails-railsconf-2014>

### 介绍

这是 Neal Kemp 在2014年 RailsConf
的演讲，介绍了他是如何做依赖第三方服务的测试。

第三方服务可以是 twitter, facebook, amazon s3
等等，使用第三方服务可以加快开发速度，更容易扩展，得到更多社交分享。

第三方服务很可能成为网站的关键节点，比如用 twitter 和 facebook
账号登录，那如何保证对第三方的请求是正确的？该如何测试？

因为第三方服务对于你的应用是一个黑盒，网络也可能不稳定，
所以你在测试的时候应该避免直接向第三方服务发送请求。

演讲重点介绍了如何不发送请求来测试对第三方服务的依赖

1. `webmock`，这是一个通用的模拟 http 请求和应答的类库。
2. `fb_graph-mock`，这是专门针对 facebook graph 的模拟类库。
3. `sham_rack`，通过内建 rack 应用来模拟 http 请求和应答。
4. `vcr`，发送一次真实的 http
   请求，记录真实的应答，然后对于之后的请求直接返回记录的应答。

使用这些类库使得测试依赖第三方服务的代码变得非常容易，
也非常快（不需要网络）。
